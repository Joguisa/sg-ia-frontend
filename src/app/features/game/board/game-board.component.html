<div class="game-board-container">
  <!-- HEADER -->
  <div class="game-header">
    <div class="header-left">
      <div class="player-info">
        <span class="player-avatar">üë§</span>
        <span class="player-name">{{ playerName() }}</span>
      </div>
    </div>

    <div class="header-center">
      <div class="difficulty-section">
        <span class="difficulty-label">Dificultad</span>
        <div class="difficulty-bar">
          <div class="difficulty-progress" [style.width.%]="difficultyPercentage()"></div>
        </div>
        <span class="difficulty-value">{{ difficulty().toFixed(1) }}/5</span>
      </div>
    </div>

    <div class="header-right">
      <div class="stats-group">
        <div class="stat-item lives">
          <span class="lives-label">Vidas:</span>
          <span *ngFor="let alive of livesDisplay()" class="heart" [class.empty]="!alive">
            ‚ù§Ô∏è
          </span>
        </div>
        <div class="stat-item score">
          <span class="score-label">üèÜ</span>
          <span class="score-value">{{ score }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="game-content">
    <!-- LOADING STATE -->
    <div *ngIf="gameState() === 'loading'" class="loading-screen">
      <div class="spinner"></div>
      <p>Cargando pregunta...</p>
    </div>

    <!-- PLAYING STATE -->
    <div *ngIf="gameState() === 'playing' && currentQuestion()" class="playing-screen">
      <!-- Question Card -->
      <div class="question-section">
        <div class="question-card">
          <div class="question-header">
            <span class="question-number">Pregunta #{{ questionCount() }}</span>
            <div [class]="'timer ' + getTimerColor()">
              <span class="timer-value">{{ questionTimer() }}s</span>
            </div>
          </div>
          <div class="question-statement">
            {{ currentQuestion()!.statement }}
          </div>
        </div>
      </div>

      <!-- Options Grid -->
      <div class="options-section">
        <div class="options-grid">
          <button
            *ngFor="let option of currentQuestion()!.options"
            class="option-button"
            [ngClass]="getOptionClass(option.id)"
            (click)="selectOption(option.id)"
            [disabled]="isAnswering()"
          >
            <span class="option-text">{{ option.text }}</span>
            <span class="option-indicator"></span>
          </button>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="action-section">
        <button
          class="btn btn-submit"
          (click)="submitAnswer()"
          [disabled]="selectedOptionId() === null || isAnswering()"
        >
          <span *ngIf="!isAnswering()">Enviar Respuesta</span>
          <span *ngIf="isAnswering()">
            <span class="spinner-small"></span> Verificando...
          </span>
        </button>
      </div>
    </div>

    <!-- FEEDBACK STATE -->
    <div *ngIf="gameState() === 'feedback' && feedbackData()" class="feedback-screen">
      <!-- Feedback Card -->
      <div class="feedback-card" [ngClass]="isAnswerCorrect() ? 'success' : 'error'">
        <!-- Result Icon and Status -->
        <div class="feedback-header">
          <div class="result-icon" [ngClass]="isAnswerCorrect() ? 'correct' : 'incorrect'">
            {{ isAnswerCorrect() ? '‚úÖ' : '‚ùå' }}
          </div>
          <h2 class="result-title">
            {{ isAnswerCorrect() ? '¬°Correcto!' : 'Respuesta Incorrecta' }}
          </h2>
        </div>

        <!-- Score Delta -->
        <div class="score-delta" [ngClass]="isAnswerCorrect() ? 'positive' : 'neutral'">
          <span *ngIf="isAnswerCorrect()" class="delta-icon">+{{ feedbackData()?.score }}</span>
          <span *ngIf="!isAnswerCorrect()" class="delta-icon">{{ feedbackData()?.score }}</span>
        </div>

        <!-- Explanation Section (CR√çTICO - Educativo) -->
        <div class="explanation-section">
          <div class="explanation-label">üìö Explicaci√≥n M√©dica:</div>
          <p class="explanation-text">
            {{ feedbackData()?.explanation || 'No hay explicaci√≥n disponible' }}
          </p>
        </div>

        <!-- Correct Option Info -->
        <div class="correct-answer-section">
          <span class="correct-label">Respuesta Correcta:</span>
          <div class="correct-option">
            <span *ngFor="let option of currentQuestion()!.options">
              <span *ngIf="option.id === feedbackData()?.correct_option_id">
                {{ option.text }}
              </span>
            </span>
          </div>
        </div>

        <!-- Stats Update -->
        <div class="stats-update">
          <div class="stat-update-item">
            <span class="stat-update-label">Puntuaci√≥n Total:</span>
            <span class="stat-update-value">{{ score() }}</span>
          </div>
          <div class="stat-update-item">
            <span class="stat-update-label">Vidas Restantes:</span>
            <span class="stat-update-value">{{ lives() }}/3</span>
          </div>
          <div class="stat-update-item">
            <span class="stat-update-label">Nueva Dificultad:</span>
            <span class="stat-update-value">{{ difficulty().toFixed(1) }}</span>
          </div>
        </div>
      </div>

      <!-- Next Button -->
      <div class="action-section">
        <button class="btn btn-next" (click)="nextQuestion()">
          Siguiente Pregunta ‚Üí
        </button>
      </div>
    </div>

    <!-- GAME OVER STATE -->
    <div *ngIf="gameState() === 'gameover'" class="gameover-screen">
      <div class="gameover-card">
        <div class="gameover-icon">üéÆ</div>
        <h2 class="gameover-title">¬°Fin del Juego!</h2>
        <p class="gameover-message">
          Completaste {{ questionCount() }} preguntas con una puntuaci√≥n de {{ score() }} puntos.
        </p>
        <p class="gameover-redirect">
          Redirigiendo a tu perfil...
        </p>
      </div>
    </div>
  </div>
</div>
