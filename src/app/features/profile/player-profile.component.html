<div class="profile-container">
  <!-- Loading State -->
  @if (isLoading()) {
  <div class="loading-container">
    <div class="spinner"></div>
    <p class="loading-text">{{ 'profile.loading' | translate }}</p>
  </div>
  }

  <!-- Error State -->
  @if (errorMessage()) {
  <div class="error-container">
    <div class="alert alert-danger d-flex align-items-start gap-2">
      <i class="fas fa-circle-info text-danger mt-1"></i>
      <div>
        <strong>{{ 'profile.error' | translate }}</strong>
        <p>{{ errorMessage() }}</p>
      </div>
    </div>
  </div>
  }

  <!-- Profile Content -->
  @if (!isLoading() && !errorMessage() && playerStats()) {
  <div class="profile-content">
    <!-- Header Card -->
    <div class="profile-header card">
      <div class="card-body">
        <div class="d-flex align-items-center gap-3 mb-3">
          <i class="fas fa-user fs-3x text-primary"></i>
          <div class="header-info">
            <h1 class="profile-title">{{ playerName() }}</h1>
            <p class="profile-subtitle">{{ 'profile.playerProfile' | translate }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <!-- Total Partidas -->
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-gamepad fs-2x text-warning mb-2"></i>
        </div>
        <div class="stat-content">
          <p class="stat-label">{{ 'profile.totalGames' | translate }}</p>
          <p class="stat-value">{{ playerStats()?.total_games || 0 }}</p>
        </div>
      </div>

      <!-- Puntaje Alto -->
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-trophy fs-2x text-success mb-2"></i>
        </div>
        <div class="stat-content">
          <p class="stat-label">{{ 'profile.highScore' | translate }}</p>
          <p class="stat-value">{{ playerStats()?.high_score || 0 }}</p>
        </div>
      </div>

      <!-- PrecisiÃ³n General -->
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-chart-pie fs-2x text-info mb-2"></i>
        </div>
        <div class="stat-content">
          <p class="stat-label">{{ 'profile.accuracy' | translate }}</p>
          <p class="stat-value">{{ getOverallAccuracy() }}%</p>
        </div>
      </div>

      <!-- Puntaje Total -->
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-arrow-up fs-2x text-success mb-2"></i>
        </div>
        <div class="stat-content">
          <p class="stat-label">{{ 'profile.totalScore' | translate }}</p>
          <p class="stat-value">{{ playerStats()?.total_score || 0 }}</p>
        </div>
      </div>
    </div>

    <!-- Difficulty Section -->
    <div class="difficulty-section card">
      <div class="card-header">
        <h3 class="section-title">{{ 'profile.avgDifficulty' | translate }}</h3>
      </div>
      <div class="card-body">
        <div class="difficulty-content">
          <div class="difficulty-info">
            <p class="difficulty-label">{{ 'profile.currentDifficultyLevel' | translate }}</p>
            <p class="difficulty-value">{{ (playerStats()?.avg_difficulty || 1).toFixed(2) }} / 5.00</p>
          </div>
          <div class="difficulty-bar">
            <div class="difficulty-progress"
              [ngClass]="'progress-' + getDifficultyColor(playerStats()?.avg_difficulty || 1)"
              [style.width.%]="((playerStats()?.avg_difficulty || 1) / 5) * 100">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Topics Section -->
    <div class="topics-section card">
      <div class="card-header">
        <h3 class="section-title">{{ 'profile.performanceByCategory' | translate }}</h3>
      </div>
      <div class="card-body">
        @if (topicStats() && topicStats()!.length > 0) {
        <div class="topics-grid">
          @for (topic of topicStats(); track topic.category_id) {
          <div class="topic-card">
            <div class="topic-header">
              <h4 class="topic-name">{{ topic.category_name }}</h4>
              <span class="topic-badge">{{ topic.answers }} {{ 'profile.questions' | translate }}</span>
            </div>

            <div class="topic-stats">
              <div class="stat-item">
                <span class="stat-key">{{ 'profile.accuracy' | translate }}</span>
                <span class="stat-val"
                  [ngClass]="'accuracy-' + (topic.accuracy >= 75 ? 'high' : topic.accuracy >= 50 ? 'medium' : 'low')">
                  {{ topic.accuracy.toFixed(1) }}%
                </span>
              </div>
              <div class="stat-item">
                <span class="stat-key">{{ 'profile.avgTime' | translate }}</span>
                <span class="stat-val">{{ formatTime(topic.avg_time_sec) }}</span>
              </div>
            </div>

            <div class="accuracy-bar">
              <div class="accuracy-progress" [style.width.%]="topic.accuracy">
              </div>
            </div>
          </div>
          }
        </div>
        } @else {
        <p class="no-data">{{ 'profile.noStats' | translate }}</p>
        }
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="btn btn-primary btn-lg btn-play" (click)="playAgain()">
        <i class="fas fa-gamepad"></i>
        {{ 'profile.playAgain' | translate }}
      </button>
      <button class="btn btn-secondary btn-lg btn-home" (click)="goToHome()">
        <i class="fas fa-home"></i>
        {{ 'profile.backToHome' | translate }}
      </button>
    </div>

    <!-- Footer Info -->
    <div class="profile-footer">
      <p class="footer-text">
        <i class="fas fa-circle-info"></i>
        {{ 'profile.statsUpdatedRealtime' | translate }}
      </p>
    </div>
  </div>
  }
</div>