<div class="leaderboard-container">
  <!-- Header -->
  <div class="leaderboard-header">
    <div class="header-content">
      <div class="header-title">
        <span class="ki-duotone ki-podium-2 fs-2x text-warning"><span class="path1"></span><span class="path2"></span><span class="path3"></span></span>
        <div class="header-text">
          <h1>Clasificación Global</h1>
          <p class="header-subtitle">Top 10 Mejores Jugadores</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p class="loading-text">Cargando clasificación...</p>
    </div>
  }

  <!-- Error State -->
  @if (errorMessage()) {
    <div class="error-container">
      <div class="alert alert-danger">
        <span class="ki-duotone ki-information-5"><span class="path1"></span><span class="path2"></span><span class="path3"></span></span>
        <div>
          <strong>Error</strong>
          <p>{{ errorMessage() }}</p>
        </div>
      </div>
    </div>
  }

  <!-- Leaderboard Content -->
  @if (!isLoading() && !errorMessage()) {
    <div class="leaderboard-content">
      <!-- My Rank Info Card -->
      @if (myRank()) {
        <div class="my-rank-card">
          <div class="rank-badge" [ngClass]="getRankColor(myRank()!)">
            @if (myRank() === 1) {
              <span class="ki-duotone ki-crown text-white"><span class="path1"></span><span class="path2"></span></span>
            } @else if (myRank() === 2) {
              <span class="ki-duotone ki-crown text-white"><span class="path1"></span><span class="path2"></span></span>
            } @else if (myRank() === 3) {
              <span class="ki-duotone ki-crown text-white"><span class="path1"></span><span class="path2"></span></span>
            } @else {
              <span class="rank-number">{{ myRank() }}</span>
            }
          </div>
          <div class="rank-info">
            <p class="rank-label">Tu Posición</p>
            <p class="rank-position">Puesto #{{ myRank() }} de {{ leaderboard().length }}</p>
          </div>
        </div>
      }

      <!-- Leaderboard Table Card -->
      <div class="leaderboard-card">
        <div class="table-responsive">
          <table class="leaderboard-table">
            <thead>
              <tr class="table-header">
                <th class="col-rank">
                  <span class="ki-duotone ki-ranking fs-2"><span class="path1"></span><span class="path2"></span></span>
                </th>
                <th class="col-player">
                  <span class="ki-duotone ki-user fs-2"><span class="path1"></span><span class="path2"></span></span>
                  Jugador
                </th>
                <th class="col-age">Edad</th>
                <th class="col-games">Partidas</th>
                <th class="col-high-score">
                  <span class="ki-duotone ki-chart-simple fs-2"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span></span>
                  Máx. Puntaje
                </th>
                <th class="col-total-score">Puntos Totales</th>
                <th class="col-accuracy">Precisión</th>
              </tr>
            </thead>
            <tbody>
              @for (player of leaderboard(); track player.player_id) {
                <tr class="table-row" [ngClass]="{ 'current-player': isCurrentPlayer(player.player_id) }">
                  <!-- Rank Column -->
                  <td class="col-rank">
                    <div class="rank-cell" [ngClass]="getRankColor(player.rank)">
                      @if (player.rank === 1) {
                        <span class="ki-duotone ki-crown fs-2x text-warning"><span class="path1"></span><span class="path2"></span></span>
                      } @else if (player.rank === 2) {
                        <span class="ki-duotone ki-crown fs-2x text-gray-400"><span class="path1"></span><span class="path2"></span></span>
                      } @else if (player.rank === 3) {
                        <span class="ki-duotone ki-crown fs-2x" style="color: #cd7f32;"><span class="path1"></span><span class="path2"></span></span>
                      } @else {
                        <span class="rank-number">{{ player.rank }}</span>
                      }
                    </div>
                  </td>

                  <!-- Player Name Column -->
                  <td class="col-player">
                    <div class="player-cell">
                      <span class="ki-duotone ki-user text-gray-500"><span class="path1"></span><span class="path2"></span></span>
                      <span class="player-name">{{ player.player_name }}</span>
                      @if (isCurrentPlayer(player.player_id)) {
                        <span class="you-badge">Tú</span>
                      }
                    </div>
                  </td>

                  <!-- Age Column -->
                  <td class="col-age">
                    <span class="age-value">{{ player.age }}</span>
                  </td>

                  <!-- Games Column -->
                  <td class="col-games">
                    <span class="games-value">{{ player.total_games }}</span>
                  </td>

                  <!-- High Score Column -->
                  <td class="col-high-score">
                    <span class="high-score-value">{{ player.high_score }}</span>
                  </td>

                  <!-- Total Score Column -->
                  <td class="col-total-score">
                    <span class="total-score-value">{{ player.total_score }}</span>
                  </td>

                  <!-- Accuracy Column -->
                  <td class="col-accuracy">
                    <div class="accuracy-cell">
                      <span class="accuracy-value" [ngClass]="'accuracy-' + (player.overall_accuracy >= 75 ? 'high' : player.overall_accuracy >= 50 ? 'medium' : 'low')">
                        {{ formatAccuracy(player.overall_accuracy) }}%
                      </span>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>

        @if (leaderboard().length === 0) {
          <div class="no-data">
            <p>No hay datos de leaderboard disponibles. ¡Sé el primero!</p>
          </div>
        }
      </div>

      <!-- Legend Section -->
      <div class="legend-section">
        <h3 class="legend-title">Información</h3>
        <div class="legend-items">
          <div class="legend-item">
            <span class="ki-duotone ki-crown text-warning"><span class="path1"></span><span class="path2"></span></span>
            <span class="legend-text">Oro - Primer lugar</span>
          </div>
          <div class="legend-item">
            <span class="ki-duotone ki-crown text-gray-400"><span class="path1"></span><span class="path2"></span></span>
            <span class="legend-text">Plata - Segundo lugar</span>
          </div>
          <div class="legend-item">
            <span class="ki-duotone ki-crown" style="color: #cd7f32;"><span class="path1"></span><span class="path2"></span></span>
            <span class="legend-text">Bronce - Tercer lugar</span>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="btn btn-primary btn-lg" (click)="goToGame()">
          <span class="ki-duotone ki-game-controller"><span class="path1"></span><span class="path2"></span></span>
          Jugar Ahora
        </button>
        <button class="btn btn-secondary btn-lg" (click)="goToPlay()">
          <span class="ki-duotone ki-home"><span class="path1"></span><span class="path2"></span></span>
          Volver al Menú
        </button>
      </div>

      <!-- Footer Info -->
      <div class="leaderboard-footer">
        <p class="footer-text">
          <span class="ki-duotone ki-information-5"><span class="path1"></span><span class="path2"></span><span class="path3"></span></span>
          Clasificación actualizada en tiempo real | {{ leaderboard().length }} jugadores en el ranking
        </p>
      </div>
    </div>
  }
</div>
